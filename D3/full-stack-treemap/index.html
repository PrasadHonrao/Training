<!DOCTYPE html>
<meta charset="utf-8">
<title>Full Stack Developer</title>
<link rel="stylesheet" type="text/css" href="style.css" />
<script src="http://d3js.org/d3.v2.js"></script>
<script src="http://code.jquery.com/jquery-1.7.1.js"></script>

<p id="chart">
    <p id="rawdata">
        <script src="treemap.js"></script>
        <script>
            function reSortRoot(root, value_key) {
                for (var key in root) {
                    if (key == "key") {
                        root.name = root.key;
                        delete root.key;
                    }
                    if (key == "values") {
                        root.children = [];
                        for (item in root.values) {
                            root.children.push(reSortRoot(root.values[item], value_key));
                        }
                        delete root.values;
                    }
                    if (key == value_key) {
                        console.log(key);
                        root.value = parseFloat(root[value_key]);
                        delete root[value_key];
                    }
                }
                return root;
            }

            $(document).ready(function () {
                //d3.csv("Home_Office_Air_Travel_Data_2011 - Copy.csv", function (csv_data) {
                d3.csv("data.csv", function (csv_data) {

                    // Add, remove or change the key values to change the hierarchy. 
                    var nested_data = d3.nest()
                        .key(function (d) { return d.Dimension; })
                        .key(function (d) { return d.SubDimension; })
                        .key(function (d) { return d.Aspect; })
                        .key(function (d) { return d.Skill; })
                        .entries(csv_data);

                    // Creat the root node for the treemap
                    var root = {};

                    // Add the data to the tree
                    root.key = "Dimensions";
                    root.values = nested_data;

                    // Change the key names and children values from .next and add values for a chosen column to define the size of the blocks
                    root = reSortRoot(root, "Weight");

                    loadData(root);

                });


            });
        </script>